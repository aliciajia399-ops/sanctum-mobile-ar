<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Golden AR Christmas - Real AR Edition</title>
    <style>
        /* ========================
           å…¨å±€ä¸åŸºç¡€æ ·å¼ (Global)
           ======================== */
        :root {
            --gold: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.6);
            --dark-bg: #050505;
            --glass: rgba(10, 10, 10, 0.85);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--dark-bg);
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
            overflow: hidden;
            color: var(--gold);
            perspective: 1000px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* ç²’å­ç”»å¸ƒå±‚ */
        #particle-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
        }

        /* é€šç”¨è§†å›¾ç»“æ„ */
        .view-section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 10; opacity: 0; transition: opacity 0.8s ease;
        }
        .view-section.active { display: flex; opacity: 1; }

        /* é€šç”¨é‡‘è‰²æŒ‰é’® */
        .btn-gold {
            background: linear-gradient(135deg, #b8860b, #ffd700);
            border: none; color: #000; padding: 12px 30px;
            font-size: 16px; font-weight: bold; border-radius: 25px;
            cursor: pointer; box-shadow: 0 0 15px var(--gold-glow);
            transition: transform 0.2s, box-shadow 0.2s; margin-top: 20px;
        }
        .btn-gold:active { transform: scale(0.95); }

        /* ========================
           èƒŒæ™¯ç¯å¢ƒåŠ¨ç”» (Background Animations)
           ======================== */
        #bg-anim-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none; overflow: hidden;
        }
        .maserati {
            position: absolute; bottom: 20%; left: -300px; font-size: 60px;
            filter: drop-shadow(0 0 10px gold) sepia(1) hue-rotate(5deg); will-change: transform;
        }
        .bg-tree {
            position: absolute; top: 10%; right: -150px; font-size: 80px;
            filter: drop-shadow(0 0 20px var(--gold)); opacity: 0.8;
        }

        /* ========================
           ç¬¬ä¸€å±ï¼šæ³¨å†Œç•Œé¢ (Login)
           ======================== */
        .wheel-container {
            position: absolute; width: 340px; height: 340px; border-radius: 50%;
            border: 2px dashed var(--gold);
            box-shadow: 0 0 20px var(--gold-glow), inset 0 0 20px var(--gold-glow);
            animation: spinWheel 4s linear infinite; z-index: -1; filter: blur(1px);
        }
        @keyframes spinWheel { to { transform: rotate(360deg); } }

        .login-panel {
            position: relative; width: 80%; max-width: 300px; padding: 30px;
            background: var(--glass); border: 1px solid var(--gold); border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8); text-align: center;
            backdrop-filter: blur(10px); animation: borderGlow 3s infinite alternate;
        }
        @keyframes borderGlow {
            0% { box-shadow: 0 0 10px var(--gold-glow); }
            100% { box-shadow: 0 0 25px var(--gold); }
        }
        .input-group { margin-bottom: 15px; }
        .input-gold {
            width: 100%; padding: 10px; background: rgba(0,0,0,0.5);
            border: 1px solid #555; color: var(--gold); border-radius: 5px;
            outline: none; box-sizing: border-box; transition: 0.3s;
        }
        .input-gold:focus { border-color: var(--gold); box-shadow: 0 0 8px var(--gold-glow); }

        /* ========================
           ç¬¬äºŒå±ï¼šè‹±é›„é€‰æ‹© (Hero Select)
           ======================== */
        .hero-container {
            display: flex; gap: 20px; justify-content: center; align-items: center; perspective: 1000px;
        }
        .hero-card {
            width: 90px; height: 140px; background: rgba(20, 20, 20, 0.9);
            border: 1px solid #444; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.4s ease, border-color 0.4s;
            position: relative; animation: floatCard 3s ease-in-out infinite;
        }
        .hero-card:nth-child(2) { animation-delay: 1s; }
        .hero-card:nth-child(3) { animation-delay: 0.5s; }
        @keyframes floatCard {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .hero-card.unlocked {
            border-color: var(--gold); box-shadow: 0 0 15px var(--gold-glow); animation: pulseGold 2s infinite;
        }
        .hero-card.locked { filter: grayscale(100%) brightness(0.5); }
        .hero-icon { font-size: 40px; margin-bottom: 10px; }
        .hero-name { font-size: 12px; color: #aaa; }
        .hero-card.unlocked .hero-name { color: var(--gold); }
        .lock-icon { position: absolute; top: 5px; right: 5px; font-size: 12px; }
        @keyframes pulseGold {
            0%, 100% { box-shadow: 0 0 10px var(--gold-glow); }
            50% { box-shadow: 0 0 25px var(--gold); }
        }

        /* ========================
           AR åœºæ™¯ (Real Camera & Image Tree)
           ======================== */
        /* çœŸå®æ‘„åƒå¤´è§†é¢‘å±‚ */
        #ar-video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1;
            transform: scaleX(-1); /* é•œåƒè‡ªæ‹ï¼Œå¦‚æœæ˜¯åç½®æ‘„åƒå¤´å¯ä»¥å»æ‰è¿™è¡Œ */
        }

        /* AR å†…å®¹å®¹å™¨ï¼Œç”¨äºæ‰‹åŠ¿æ—‹è½¬ */
        #ar-content-container {
            position: relative; width: 300px; height: 450px;
            perspective: 1000px;
            transform-style: preserve-3d; transition: transform 0.1s linear;
            /* åˆå§‹çŠ¶æ€ */
            transform: scale(0) rotateY(0deg);
        }

        /* æ›¿æ¢ä¸ºçœŸå®çš„å›¾ç‰‡æ ‘ */
        #ar-tree-image {
            width: 100%; height: 100%; object-fit: contain;
            /* å¢åŠ é‡‘è‰²å‘å…‰æ»¤é•œä»¥èå…¥ç¯å¢ƒ */
            filter: drop-shadow(0 0 20px var(--gold-glow)) brightness(1.2);
            /* ç¡®ä¿æ—‹è½¬æ—¶èƒŒé¢å¯è§ (è™½ç„¶æ˜¯2Då›¾ï¼Œä½†æ—‹è½¬éœ€è¦) */
            backface-visibility: visible; 
        }

        .hand-guide {
            position: absolute; bottom: 15%; font-size: 24px;
            color: var(--gold); text-shadow: 0 0 10px black;
            opacity: 0; animation: fadeUp 2s ease-in-out infinite;
            pointer-events: none; z-index: 20;
        }
        @keyframes fadeUp {
            0% { opacity: 0; transform: translateY(20px); }
            50% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        #ar-timer {
            position:absolute; top:30px; right: 30px; font-size:32px; font-weight:bold; color:var(--gold);
            text-shadow: 0 0 10px black; z-index: 20;
        }

        /* ========================
           å¼¹çª— (Modal)
           ======================== */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: rgba(20,20,20,0.95); border: 1px solid var(--gold);
            padding: 25px; border-radius: 10px; text-align: center; width: 80%;
            box-shadow: 0 0 30px var(--gold-glow); transform: scale(0.8); transition: transform 0.3s;
        }
        .modal-box.show { transform: scale(1); }
        .modal-title { font-size: 20px; color: var(--gold); margin-bottom: 15px; }
        .btn-outline {
            background: transparent; border: 1px solid var(--gold); color: var(--gold);
            padding: 8px 20px; border-radius: 20px; margin: 0 10px;
        }

        /* ========================
           åœ£è¯è€äººäº’åŠ¨ (Santa Image)
           ======================== */
        #santa-actor-img {
            width: 80%; max-width: 400px; object-fit: contain;
            filter: drop-shadow(0 0 30px var(--gold-glow));
            transform: scale(0.1); transition: transform 1s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        .shake-warning-text {
             color: red; text-shadow: 0 0 10px red; text-align: center; padding: 20px; font-size: 24px;
        }

        /* ç¤¼ç‰©é£å‘é•œå¤´ */
        #gift-fly {
            position: fixed; top: 50%; left: 50%; font-size: 80px;
            transform: translate(-50%, -50%) scale(0); z-index: 200; pointer-events: none;
        }
        /* ç²’å­çˆ†ç‚¸å®¹å™¨ */
        #explosion-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
        }
        .particle-boom { position: absolute; background: var(--gold); border-radius: 50%; }

    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>
    
    <div id="bg-anim-layer"></div>

    <section id="view-login" class="view-section active">
        <div class="wheel-container"></div>
        <div class="login-panel">
            <h2 style="margin-top:0;">VIP ACCESS</h2>
            <div class="input-group"><input type="tel" class="input-gold" placeholder="æ‰‹æœºå·"></div>
            <div class="input-group"><input type="text" class="input-gold" placeholder="éªŒè¯ç "></div>
            <button class="btn-gold" onclick="app.login()">ç«‹å³ç™»å½•</button>
        </div>
    </section>

    <section id="view-hero" class="view-section">
        <h2 style="margin-bottom: 40px; text-shadow: 0 0 10px var(--gold);">é€‰æ‹©ä½ çš„è‹±é›„</h2>
        <div class="hero-container">
            <div class="hero-card unlocked" onclick="alert('å·²è£…å¤‡ï¼šé‡‘è‰²ç›èæ‹‰è’‚')">
                <div class="hero-icon">ğŸï¸</div>
                <div class="hero-name">GT é»„é‡‘ç‰ˆ</div>
            </div>
            <div id="card-tree" class="hero-card locked" onclick="app.clickTreeCard()">
                <div class="lock-icon">ğŸ”’</div>
                <div class="hero-icon">ğŸ„</div>
                <div class="hero-name">å¹»å½±åœ£è¯æ ‘</div>
            </div>
            <div class="hero-card locked" onclick="alert('æ•¬è¯·æœŸå¾…')">
                <div class="hero-icon">â“</div>
                <div class="hero-name">ç¥ç§˜å˜‰å®¾</div>
            </div>
        </div>
    </section>

    <section id="view-customize" class="view-section">
        <h2 class="modal-title">å®šåˆ¶ä½ çš„ç¥ç¦</h2>
        <input type="text" id="wish-input" class="input-gold" style="width: 80%; text-align:center;" maxlength="20" placeholder="è¾“å…¥20å­—ä»¥å†…ç¥ç¦">
        <button class="btn-gold" onclick="app.confirmCustomization()">ç¡®è®¤ç”Ÿæˆ</button>
    </section>

    <section id="view-santa" class="view-section">
        <img id="santa-actor-img" src="image_1.png" alt="Golden Santa">
        <h2 id="santa-msg" class="shake-warning-text">
            é£å¿«æ‘‡åŠ¨ä½ çš„æ‰‹ï¼<br>é¿å…ç¢°æ’ï¼
        </h2>
        <button onclick="app.triggerShake()" style="opacity: 0.5; margin-top:20px; color:#888; background:none; border:1px solid #555; padding: 5px 10px; border-radius: 15px;">(ç”µè„‘ç«¯ç‚¹å‡»æ¨¡æ‹Ÿæ‘‡æ‰‹)</button>
    </section>

    <section id="view-ar" class="view-section" style="justify-content: flex-end; padding-bottom: 100px; box-sizing: border-box;">
        <video id="ar-video" autoplay playsinline muted></video>
        
        <div id="ar-content-container">
            <img id="ar-tree-image" src="image_0.png" alt="Golden AR Tree">
        </div>

        <div class="hand-guide">ğŸ‘† åœ¨å±å¹•ä¸Šå·¦å³æ‹–åŠ¨æ—‹è½¬</div>
        <div id="ar-timer">12s</div>
    </section>

    <div id="modal" class="modal-overlay">
        <div class="modal-box" id="modal-box">
            <h3 id="modal-title" class="modal-title">æ ‡é¢˜</h3>
            <div id="modal-content" style="margin-bottom:20px; font-size:14px; color:#ccc;">å†…å®¹</div>
            <div id="modal-btns" style="display: flex; justify-content: center;"></div>
        </div>
    </div>

    <div id="explosion-container"></div>
    <div id="gift-fly">ğŸ</div>

<script>
const app = {
    state: {
        treeUnlocked: false,
        isSantaFlow: false,
        shakeCount: 0,
        videoStream: null
    },

    init() {
        this.initParticles();
        this.startBgAnimations();
        console.log("System Initialized: Real AR Edition");
    },

    switchView(viewId) {
        // åˆ‡æ¢è§†å›¾æ—¶å°è¯•åœæ­¢æ‘„åƒå¤´ä»¥èŠ‚çœèµ„æº
        if (viewId !== 'view-ar') this.stopCamera();
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    },

    // --- æ‘„åƒå¤´æ§åˆ¶ ---
    async startCamera() {
        const videoElement = document.getElementById('ar-video');
        if (this.state.videoStream) return; // å·²ç»å¼€å¯

        try {
            // è¯·æ±‚æ‘„åƒå¤´æƒé™ï¼Œä¼˜å…ˆåç½®æ‘„åƒå¤´
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' },
                audio: false
            });
            videoElement.srcObject = stream;
            this.state.videoStream = stream;
            console.log("Camera access granted.");
        } catch (err) {
            console.error("Camera access denied:", err);
            alert("æ— æ³•å¼€å¯æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®ã€‚AR åŠŸèƒ½å°†ä½¿ç”¨é»‘è‰²èƒŒæ™¯ã€‚");
        }
    },

    stopCamera() {
        if (this.state.videoStream) {
            this.state.videoStream.getTracks().forEach(track => track.stop());
            this.state.videoStream = null;
            document.getElementById('ar-video').srcObject = null;
        }
    },

    // --- ä¸šåŠ¡é€»è¾‘ ---
    login() {
        const btn = document.querySelector('#view-login .btn-gold');
        btn.innerText = "æ­£åœ¨éªŒè¯...";
        setTimeout(() => {
            btn.innerText = "ç™»å½•æˆåŠŸ";
            setTimeout(() => this.switchView('view-hero'), 800);
        }, 1000);
    },

    clickTreeCard() {
        if (this.state.treeUnlocked) {
            this.showModal("å·²è§£é”", "å†æ¬¡æ¬£èµ AR çƒŸèŠ±ç§€ï¼Ÿ", 
                [{ text: "ç¡®è®¤", action: () => { this.closeModal(); this.enterARScene(); }}]
            );
        } else {
            this.showModal("å°Šè´µçš„ä¼šå‘˜", "æ˜¯å¦å®šåˆ¶ä½ çš„ä¸“å±åœ£è¯ç¤¼ç‰©ï¼Ÿ", 
                [
                    { text: "å¦ (ç›´æ¥ä½“éªŒ)", action: () => { this.closeModal(); this.confirmARStart(); }},
                    { text: "æ˜¯ (ä¸“å±å®šåˆ¶)", action: () => { this.closeModal(); this.switchView('view-customize'); }}
                ]
            );
        }
    },

    confirmARStart() {
        this.showModal("æƒé™è¯·æ±‚", "éœ€è¦æ‰“å¼€æ‘„åƒå¤´ä»¥å¯ç”¨ AR æ‰‹åŠ¿æ—‹è½¬åœ£è¯æ ‘", [
            { text: "å…è®¸å¹¶å¼€å¯", action: () => {
                this.closeModal();
                this.enterARScene();
            }}
        ]);
    },

    confirmCustomization() {
        if(!document.getElementById('wish-input').value) return alert("è¯·è¾“å…¥ç¥ç¦");
        this.switchView('view-santa');
        this.startSantaGame();
    },

    // --- åœ£è¯è€äººäº’åŠ¨ (å›¾ç‰‡ç‰ˆ) ---
    startSantaGame() {
        const santaImg = document.getElementById('santa-actor-img');
        // é‡ç½®çŠ¶æ€
        santaImg.style.transform = "scale(0.1)";
        // åŠ¨ç”»ï¼šå›¾ç‰‡å†²å‘é•œå¤´
        setTimeout(() => {
            santaImg.style.transform = "scale(1.1) translateY(50px)"; // æ”¾å¤§å¹¶ç¨å¾®ä¸‹ç§»
        }, 100);

        this.state.shakeCount = 0;
        this.shakeHandler = this.handleDeviceMotion.bind(this);
        window.addEventListener('devicemotion', this.shakeHandler, false);
    },

    handleDeviceMotion(event) {
        const acc = event.accelerationIncludingGravity;
        if (!acc) return;
        if (Math.abs(acc.x + acc.y + acc.z) > 20) this.triggerShake();
    },

    triggerShake() {
        this.state.shakeCount++;
        const santaImg = document.getElementById('santa-actor-img');
        // æ‘‡åŠ¨åé¦ˆåŠ¨ç”»
        santaImg.style.transition = "transform 0.1s";
        santaImg.style.transform = `scale(1.1) translateY(50px) rotate(${Math.random()*10 - 5}deg)`;

        if (this.state.shakeCount >= 5) {
            window.removeEventListener('devicemotion', this.shakeHandler);
            this.santaSuccess();
        }
    },

    santaSuccess() {
        const msg = document.getElementById('santa-msg');
        msg.innerText = "åœ£è¯è€äººæ”¶åˆ°äº†ä½ çš„ä¿¡å·ï¼";
        msg.style.color = "var(--gold)"; textShadow = "none";
        
        setTimeout(() => {
            const flyGift = document.getElementById('gift-fly');
            flyGift.style.transition = "transform 0.6s cubic-bezier(0.5, 0, 1, 1)";
            flyGift.style.transform = "translate(-50%, -50%) scale(20)";
            flyGift.style.opacity = "1";
            
            setTimeout(() => {
                document.body.style.background = "#000";
                document.getElementById('view-santa').style.opacity = 0;
                setTimeout(() => {
                    flyGift.style.display = 'none'; flyGift.style.transform = "translate(-50%, -50%) scale(0)";
                    document.body.style.background = "var(--dark-bg)";
                    this.state.isSantaFlow = true;
                    this.confirmARStart();
                }, 500);
            }, 400);
        }, 800);
    },

    // --- æ ¸å¿ƒ AR åœºæ™¯ (çœŸå®æ‘„åƒå¤´ + å›¾ç‰‡æ—‹è½¬) ---
    async enterARScene() {
        this.switchView('view-ar');
        // 1. å…ˆå¼€å¯æ‘„åƒå¤´
        await this.startCamera();

        // 2. æ˜¾ç¤º AR å†…å®¹åŠ¨ç”»
        const arContainer = document.getElementById('ar-content-container');
        arContainer.style.transform = "scale(0) rotateY(0deg)"; // é‡ç½®åˆå§‹çŠ¶æ€
        
        setTimeout(() => {
            arContainer.style.transition = "transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)";
            // å‡ºç°åŠ¨ç”»ï¼šæ”¾å¤§å¹¶ä¿æŒ Y è½´ 0 åº¦
            arContainer.style.transform = "scale(1) rotateY(0deg)";
            // åŠ¨ç”»å®Œæˆåå¼€å¯æ‰‹åŠ¿æ§åˆ¶
            setTimeout(() => {
                 arContainer.style.transition = "transform 0.1s linear"; // åˆ‡æ¢å›å®æ—¶è·Ÿéšæ¨¡å¼
                 this.initARDragControl();
            }, 1500);
        }, 500); // ç­‰æ‘„åƒå¤´ç¨å¾®ç¨³å®šä¸€ç‚¹å†å‡ºæ ‘

        // å€’è®¡æ—¶é€»è¾‘
        let timeLeft = 12;
        const timerEl = document.getElementById('ar-timer');
        timerEl.innerText = timeLeft + "s";
        this.arInterval = setInterval(() => {
            timeLeft--; timerEl.innerText = timeLeft + "s";
            if(timeLeft <= 0) { clearInterval(this.arInterval); this.explodeTree(); }
        }, 1000);
    },

    // çœŸå®æ‰‹åŠ¿æ§åˆ¶ (æ§åˆ¶å›¾ç‰‡çš„ Y è½´æ—‹è½¬)
    initARDragControl() {
        const touchZone = document.getElementById('view-ar');
        const target = document.getElementById('ar-content-container');
        let startX = 0;
        let currentRotation = 0;
        let isDragging = false;

        const updateRotation = (currentX) => {
            const deltaX = currentX - startX;
            // è®¡ç®—æ–°çš„æ—‹è½¬è§’åº¦ï¼Œä¹˜ä»¥ç³»æ•°è°ƒæ•´çµæ•åº¦
            const newRotation = currentRotation + deltaX * 0.5;
            target.style.transform = `scale(1) rotateY(${newRotation}deg)`;
        };

        // Touch Events (ç§»åŠ¨ç«¯)
        touchZone.ontouchstart = (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
        };
        touchZone.ontouchmove = (e) => {
            if (!isDragging) return;
            e.preventDefault(); // é˜²æ­¢å±å¹•æ»šåŠ¨
            updateRotation(e.touches[0].clientX);
        };
        touchZone.ontouchend = (e) => {
            if (!isDragging) return;
            // ä¿å­˜å½“å‰çš„æ—‹è½¬è§’åº¦ä½œä¸ºä¸‹ä¸€æ¬¡çš„èµ·ç‚¹
            currentRotation += (e.changedTouches[0].clientX - startX) * 0.5;
            isDragging = false;
        };

        // Mouse Events (æ¡Œé¢ç«¯è°ƒè¯•)
        touchZone.onmousedown = (e) => { startX = e.clientX; isDragging = true; };
        touchZone.onmousemove = (e) => { if(isDragging) updateRotation(e.clientX); };
        touchZone.onmouseup = (e) => { 
            if(isDragging) currentRotation += (e.clientX - startX) * 0.5; 
            isDragging = false; 
        };
    },

    explodeTree() {
        const treeImg = document.getElementById('ar-tree-image');
        const rect = treeImg.getBoundingClientRect();
        // é«˜äº®åŠ¨ç”»
        treeImg.style.transition = "0.3s";
        treeImg.style.filter = "brightness(3) drop-shadow(0 0 50px gold)";
        treeImg.style.transform = "scale(1.1)";

        setTimeout(() => {
            treeImg.style.opacity = 0; // æ¶ˆå¤±
            this.createExplosion(rect.left + rect.width/2, rect.top + rect.height/2);
            this.stopCamera(); // çˆ†ç‚¸ååœæ­¢æ‘„åƒå¤´

            setTimeout(() => {
                this.state.treeUnlocked = true;
                document.getElementById('card-tree').classList.replace('locked', 'unlocked');
                document.querySelector('#card-tree .lock-icon').style.display = 'none';
                
                if (!this.state.isSantaFlow) {
                    this.showModal("æç¤º", "æ˜¯å¦å®šåˆ¶ä½ çš„ä¸“å±åœ£è¯ç¤¼ç‰©ï¼Ÿ", 
                         [{ text: "æ˜¯", action: () => { this.closeModal(); this.switchView('view-customize'); }}]
                    );
                } else {
                    alert("ä½“éªŒå®Œæˆï¼åœ£è¯æ ‘å·²æ°¸ä¹…è§£é”ã€‚");
                    this.switchView('view-hero');
                }
                // é‡ç½®æ ‘çš„çŠ¶æ€ä»¥ä¾¿ä¸‹æ¬¡æ˜¾ç¤º
                setTimeout(() => {
                    treeImg.style.opacity = 1;
                    treeImg.style.filter = "drop-shadow(0 0 20px var(--gold-glow)) brightness(1.2)";
                    treeImg.style.transform = "scale(1)";
                }, 1000);
            }, 1500);
        }, 500);
    },

    createExplosion(x, y) {
        const container = document.getElementById('explosion-container');
        for(let i=0; i<60; i++) {
            const p = document.createElement('div');
            p.className = 'particle-boom';
            const size = Math.random() * 8 + 3;
            p.style.cssText = `width:${size}px; height:${size}px; left:${x}px; top:${y}px;`;
            container.appendChild(p);

            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 200 + 80;
            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px) scale(0)`, opacity: 0 }
            ], { duration: 1000 + Math.random()*600, easing: 'cubic-bezier(0, .9, .57, 1)' })
            .onfinish = () => p.remove();
        }
    },

    // --- é€šç”¨å·¥å…· ---
    showModal(title, content, buttons) {
        const box = document.getElementById('modal-box');
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-content').innerText = content;
        const btnGroup = document.getElementById('modal-btns');
        btnGroup.innerHTML = '';
        buttons.forEach(b => {
            const btn = document.createElement('button');
            btn.className = 'btn-outline'; btn.innerText = b.text; btn.onclick = b.action;
            btnGroup.appendChild(btn);
        });
        document.getElementById('modal').style.display = 'flex';
        setTimeout(() => box.classList.add('show'), 10);
    },
    closeModal() {
        document.getElementById('modal-box').classList.remove('show');
        setTimeout(() => document.getElementById('modal').style.display = 'none', 300);
    },

    // --- èƒŒæ™¯åŠ¨ç”»ä¸ç²’å­ ---
    startBgAnimations() {
        const layer = document.getElementById('bg-anim-layer');
        // ç›èæ‹‰è’‚
        setInterval(() => {
            const car = document.createElement('div'); car.className = 'maserati'; car.innerText = 'ğŸï¸';
            layer.appendChild(car);
            car.animate([{ left: '-20%', opacity: 0 }, { left: '120%', opacity: 1 }], 2500).onfinish = () => car.remove();
        }, 7000);
        // èƒŒæ™¯æ ‘
        setInterval(() => {
            const tree = document.createElement('div'); tree.className = 'bg-tree'; tree.innerText = 'ğŸ„';
            layer.appendChild(tree);
            tree.animate([
                { transform: 'rotate(0deg) scale(0.5)', opacity: 0, right: '-50px' },
                { transform: 'rotate(-360deg) scale(1)', opacity: 1, right: '50px' },
                { transform: 'rotate(-720deg) scale(1.2)', opacity: 0, right: '150px' }
            ], 5000).onfinish = () => tree.remove();
        }, 8000);
    },

    initParticles() {
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        const resize = () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; };
        window.addEventListener('resize', resize); resize();
        
        const particles = Array.from({length: 80}, () => ({
            x: Math.random()*width, y: Math.random()*height,
            size: Math.random()*2, speedY: Math.random()*0.5+0.1, opacity: Math.random()
        }));

        const animate = () => {
            ctx.clearRect(0,0,width,height);
            const grad = ctx.createLinearGradient(0,0,width,height);
            grad.addColorStop(0,"transparent"); grad.addColorStop(0.5,"rgba(255,215,0,0.05)"); grad.addColorStop(1,"transparent");
            ctx.fillStyle = grad; ctx.fillRect(0,0,width,height);

            particles.forEach(p => {
                p.y -= p.speedY;
                if(p.y < 0) { p.y = height; p.x = Math.random()*width; }
                ctx.fillStyle = `rgba(255, 215, 0, ${p.opacity})`;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animate);
        };
        animate();
    }
};

window.onload = () => app.init();
</script>
</body>
</html>
